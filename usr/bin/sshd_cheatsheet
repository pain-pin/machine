#!/usr/bin/env bash
# sshd wrapper

PORT=${1:-22}
CONFIG=${2:-/etc/ssh/sshd_config}
LOG=${3:-/tmp/sshd_wrapper.log}

start_sshd() {
    echo "Starting sshd on port $PORT with config $CONFIG" | tee -a "$LOG"
    /usr/sbin/sshd -D -p "$PORT" -f "$CONFIG"
}

reload_sshd() {
    echo "Reloading sshd" | tee -a "$LOG"
    pkill -HUP sshd
}

stop_sshd() {
    echo "Stopping sshd" | tee -a "$LOG"
    pkill sshd
}

case "${4:-start}" in
    start)  start_sshd ;;
    reload) reload_sshd ;;
    stop)   stop_sshd ;;
    *) echo "Usage: $0 [PORT] [CONFIG] [LOG] {start|reload|stop}" ;;
esac


#!/usr/bin/bash

if [ "$#" -ne 1 ] ; then
    echo "Usage: $0 .iso"
    exit 1
fi

ISO="$1"
WORKDIR=iso_edit
MNT=mnt
NEWISO=custom.iso

mkdir -p "$MNT" "$WORKDIR"
sudo mount -o loop "$ISO" "$MNT"

echo "[*] Copying contents..."
cp -a "$MNT"/* "$WORKDIR"
sudo umount "$MNT"

echo "[*] Enter chroot (bind mounts first)"
sudo mount --bind /dev "$WORKDIR/dev"
sudo mount --bind /sys "$WORKDIR/sys"
sudo mount --bind /proc "$WORKDIR/proc"
sudo chroot "$WORKDIR" /bin/bash

echo """
run:
post-chroot-iso
"""
# sudo umount "$WORKDIR"/{proc,sys,dev}
# genisoimage -o "$NEWISO" -V "CUSTOM" -R -J "$WORKDIR"
# note : from cdrkit package

exit 0

